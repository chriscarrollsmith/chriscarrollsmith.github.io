<p>The building block of the Transformer is the "vector": an array of floats (numbers), like <code>(0.1, 0.2, 0.3)</code>. Words or parts of words ("tokens") are represented as a vectors, typically with dimensions <code>1 x n</code> where <code>n</code> ranges from 768 to over 12,000. Every vector points to a location in <code>n-dimensional</code> space, and geometric relationships between vectors contain information about semantic relationships between the tokens they represent.</p><p>Here's something new and important I just learned. As someone who's taken geometry but not linear algebra, I have been mentally modeling a token vector (or "token embedding", because we "embed" the token in vector space by representing it there) of <code>n</code> dimensions as a <b>point coordinate</b> in <code>n</code>-dimensional space. Just as (0,0) is the 2-D origin and (0,0,0) is the 3-D origin, we can use (0,â€¦,0) vector of <code>n</code> length to represent the origin in <code>n</code>-D space. And I've basically been thinking of the length of the straight line that connects such points in high-D space (the "Euclidean distance") as a measure of the similarity of meaning and usage ("semantic similarity") between two tokens. <em>But today I learned that this mental model is incorrect (or at least incomplete).</em></p><figure>  <img src="/images/cosine-similarity-1.png" alt="Diagram showing vectors as points in space"></figure><p>In the context of transformers, we should mentally model semantic embeddings as a <strong>ray extending outward from the origin and ending at the point coordinate defined by the vector</strong>. The <strong>angle between the two vectors measures the semantic similarity</strong>. Vectors that point in similar directions represent tokens with similar meaning or usage context (e.g., king and queen). When we do "cosine similarity search" during RAG ("retrieval augmented generation"), we are saying "let's find the vector with the smallest angle (and thus greatest semantic similarity) to our search query. Euclidean distance between points is less informative for semantic similarity than the angle.</p><figure>  <img src="/images/cosine-similarity-2.png" alt="Diagram showing vectors as rays from the origin with angles between them"></figure><p>The angle is also closely related to the "dot product" of the two vectors (the sum of the products of the two sequences of numbers). In fact, for vectors of the same length ("magnitude"), the angle <strong>is</strong> the dot product. Which is why cosine similarity is measured by normalizing vector magnitudes to 1 and then computing dot product. Magnitude often represents certainty or importance of the token.</p><p>Because the <em>magnitudes</em> of A and B above are similar, they are closer by Euclidean distance than B and C below. But this is misleading. Because the <em>angle</em> between B and C is smaller, they are actually the more semantically similar vectors.</p><figure>  <img src="/images/cosine-similarity-3.png" alt="2D plot showing vectors A, B, and C as rays from the origin, demonstrating that angle matters more than distance"></figure>