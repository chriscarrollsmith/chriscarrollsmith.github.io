---
import './Header.css';

const currentPath = Astro.url.pathname;
---

<div id="header">
  <a href="/#home" data-hash-link>Home</a>
  <a href="/#about" data-hash-link>About</a>
  <a href="/#projects" data-hash-link>Projects</a>
  <a href="/#writing" data-hash-link>Writing</a>
  <a href="/#events" data-hash-link>Events</a>
  <a href="/cv" class:list={[{ active: currentPath.startsWith('/cv') }]}>CV</a>
  <a href="/blog" class:list={[{ active: currentPath.startsWith('/blog') }]}>Blog</a>
</div>

<script>
  // Handle hash navigation from non-home pages
  // When clicking a hash link from /blog or /cv, store the hash and scroll after page load
  document.querySelectorAll<HTMLAnchorElement>('a[data-hash-link]').forEach(link => {
    link.addEventListener('click', () => {
      const href = link.getAttribute('href');
      if (href) {
        const hash = href.split('#')[1];
        if (hash && window.location.pathname !== '/') {
          // Store hash to scroll to after navigation
          sessionStorage.setItem('scrollToHash', hash);
        }
      }
    });
  });

  // On page load, check if we need to scroll to a hash
  const scrollToHash = sessionStorage.getItem('scrollToHash');
  if (scrollToHash) {
    sessionStorage.removeItem('scrollToHash');

    // Function to scroll to element once it exists
    const scrollToElement = () => {
      const element = document.getElementById(scrollToHash);
      if (element) {
        // Use instant scroll for reliability, smooth scroll can race with assertions
        element.scrollIntoView({ behavior: 'instant' });
        return true;
      }
      return false;
    };

    // Try immediately, then poll for element (handles client:only components)
    if (!scrollToElement()) {
      const maxAttempts = 50; // 5 seconds max
      let attempts = 0;
      const interval = setInterval(() => {
        attempts++;
        if (scrollToElement() || attempts >= maxAttempts) {
          clearInterval(interval);
        }
      }, 100);
    }
  }
</script>
